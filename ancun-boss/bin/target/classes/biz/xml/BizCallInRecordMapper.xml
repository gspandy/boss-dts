<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ancun.boss.persistence.biz.mapper.BizCallInRecordMapper" >
  <resultMap id="BaseResultMap" type="com.ancun.boss.pojo.callInfo.CallInRecordBusinessOutput" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ID" property="id" jdbcType="BIGINT" />
    <result column="USER_NO" property="userNo" jdbcType="VARCHAR" />
    <result column="USER_NAME" property="userName" jdbcType="VARCHAR" />
    <result column="CALLTIME" property="calltime" jdbcType="VARCHAR" />
    <result column="CALLPHONE" property="callphone" jdbcType="VARCHAR" />
    <result column="SEX" property="sex" jdbcType="VARCHAR" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="DURATION" property="duration" jdbcType="VARCHAR" />
    <result column="BUSINESS" property="business" jdbcType="VARCHAR" />
    <result column="QUESTION" property="question" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="CALL_BACK" property="callBack" jdbcType="VARCHAR" />
    <result column="VISIT_SITUATION" property="visitSituation" jdbcType="VARCHAR" />
    <result column="BUSINESS_NAME" property="businessName" jdbcType="VARCHAR" />
    <result column="CALL_BACK_NAME" property="callBackName" jdbcType="VARCHAR" />
    <result column="SEX_NAME" property="sexName" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="queryCallInRecordList" parameterType="com.ancun.boss.pojo.callInfo.CallInRecordInput" resultMap="BaseResultMap">
	 SELECT DISTINCT 
	 t1.ID,
	 t1.USER_NO,
	 t1.USER_NAME,
	 t1.CALLTIME,
	 t1.CALLPHONE,
	 t1.SEX,
	 t1.NAME,
	 t1.DURATION,
	 t1.BUSINESS,
	 t1.QUESTION,
	 t1.REMARK,
	 t1.CALL_BACK,
	 t1.VISIT_SITUATION,
	 t2.`NAME` BUSINESS_NAME,
	 t3.`NAME` SEX_NAME,
	 t4.`NAME` CALL_BACK_NAME
	 FROM CALL_IN_RECORD t1
	 LEFT JOIN SYSTEM_BASIC_CONFIG t2 ON t1.BUSINESS = t2.`CODE` AND t2.MOUDLECODE = 'BIZ-NAME'
	 LEFT JOIN SYSTEM_BASIC_CONFIG t3 ON t1.SEX = t3.`CODE` AND t3.MOUDLECODE = 'SEX'
	 LEFT JOIN SYSTEM_BASIC_CONFIG t4 ON t1.CALL_BACK = t4.`CODE` AND t4.MOUDLECODE = 'CALL_BACK'
	 where 1= 1
	 <if test="callphone != null and callphone != ''">
	 	 AND t1.CALLPHONE = #{callphone,jdbcType=VARCHAR}
	 </if>
	 <if test="business != null and business != ''">
	 	 AND t1.BUSINESS = #{business,jdbcType=VARCHAR}
	 </if>
	 <if test="calltimestart != null and calltimestart != ''">
	 	 AND t1.CALLTIME &gt;= #{calltimestart,jdbcType=VARCHAR}
	 </if>
	 <if test="calltimeend != null and calltimeend != ''">
	 	 AND t1.CALLTIME &lt;= date_add(#{calltimeend,jdbcType=VARCHAR}, INTERVAL 1 day)  
	 </if>
	 ORDER BY t1.ID DESC		
  </select>
  
    <select id="queryCallInRecordinfo" parameterType="java.lang.Long" resultMap="BaseResultMap">
	SELECT 
	t1.ID,
	t1.CALLPHONE,
	t1.CALLTIME,
	t1.BUSINESS,
	t1.`NAME`,
	t1.SEX,
	t1.DURATION,
	t1.CALL_BACK,
	t1.QUESTION,
	t1.REMARK,
	t1.VISIT_SITUATION,
	t2.`NAME` businessName
	FROM 
	CALL_IN_RECORD t1
	LEFT JOIN
	SYSTEM_BASIC_CONFIG t2 
	ON
	t1.BUSINESS = t2.`CODE`
	WHERE 
	t1.ID = #{id,jdbcType=VARCHAR}
	ORDER BY t1.ID DESC		
  </select>
</mapper>