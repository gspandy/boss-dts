<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ancun.boss.persistence.biz.BizMarketCheckMapper">
    <resultMap id="BaseResultMap" type="com.ancun.boss.pojo.marketInfo.MarketCheckInfoPojo">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
	    <id column="PHONE_NO" property="phoneNo" jdbcType="VARCHAR" />
	    <result column="BUSINESS" property="business" jdbcType="VARCHAR" />
	    <result column="MARKET_WAY" property="marketWay" jdbcType="VARCHAR" />
	    <result column="CALLED_TEAM" property="calledTeam" jdbcType="VARCHAR" />
	    <result column="MARKET_NO" property="marketNo" jdbcType="VARCHAR" />
	    <result column="MARKET_TIME" property="marketTime" jdbcType="VARCHAR" />
	    <result column="CHECK_NO" property="checkNo" jdbcType="VARCHAR" />
	    <result column="CHECK_RESULT" property="checkResult" jdbcType="VARCHAR" />
	    <result column="SAMPLING" property="sampling" jdbcType="VARCHAR" />
	    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
	    <result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
	    <result column="CHECK_RESULT_NAME" property="checkResultName" jdbcType="VARCHAR" />
	    <result column="BUSINESS_NAME" property="businessName" jdbcType="VARCHAR" />
	    <result column="CALLED_TEAM_NAME" property="calledTeamName" jdbcType="VARCHAR" />
	    <result column="VOICE_ID" property="voiceID" jdbcType="VARCHAR" />
    </resultMap>

    <select id="selectMakretCheckList" parameterType="com.ancun.boss.pojo.marketInfo.MarketCheckQueryInput" resultMap="BaseResultMap">
    SELECT t1.PHONE_NO, t1.BUSINESS, t1.MARKET_WAY, t1.CALLED_TEAM, t1.MARKET_NO, STR_TO_DATE(t1.MARKET_TIME, '%Y-%m-%d') AS MARKET_TIME,  t1.CHECK_NO,
        t1.CHECK_RESULT, t1.SAMPLING, t1.OPERATOR, t1.REMARK, t2.NAME AS CHECK_RESULT_NAME, t3.NAME AS BUSINESS_NAME, t4.ID AS VOICE_ID
    FROM
        MARKET_CHECK t1
    LEFT JOIN SYSTEM_BASIC_CONFIG t2 ON t1.CHECK_RESULT = t2.CODE AND t2.MOUDLECODE = 'CHECK-RESULT'
    LEFT JOIN SYSTEM_BASIC_CONFIG t3 ON t1.BUSINESS = t3.CODE AND t3.MOUDLECODE = 'BIZ-NAME'
    LEFT JOIN CALLED_VOICE t4 ON t1.BUSINESS = t4.BUSINESS AND t1.CALLED_TEAM = t4.CALLED_TEAM AND REPLACE(t1.MARKET_TIME,'-','') = t4.MARKET_TIME AND t1.PHONE_NO = t4.MAKRET_PHONE AND t4.STATUS = 'SUCCESS'
    WHERE 1=1
    <if test="business != null and business !=''" >
        AND t1.BUSINESS = #{business,jdbcType=VARCHAR}
    </if>
    <if test="operator != null and operator !=''" >
        AND t1.OPERATOR = #{operator,jdbcType=VARCHAR}
    </if>
    <if test="marketWay != null and marketWay !=''" >
        AND t1.MARKET_WAY = #{marketWay,jdbcType=VARCHAR}
    </if>
    <if test="marketNo !=null and marketNo !=''">
        AND t1.MARKET_NO  = #{marketNo,jdbcType=VARCHAR}
    </if>
    <if test="checkNo !=null and checkNo !=''">
        AND t1.CHECK_NO = #{checkNo,jdbcType=VARCHAR}
    </if>
    <if test="checkResult !=null and checkResult !=''">
        AND t1.CHECK_RESULT = #{checkResult,jdbcType=VARCHAR}
    </if>
        ORDER BY MARKET_TIME DESC
  </select>
  
  <select id="selectMarketCheck" parameterType="com.ancun.boss.pojo.marketInfo.MarketCheckQueryInput" resultMap="BaseResultMap">
    SELECT t1.PHONE_NO, t1.BUSINESS, t1.MARKET_WAY, t1.CALLED_TEAM, t1.MARKET_NO, t1.MARKET_TIME,  t1.CHECK_NO,
        t1.CHECK_RESULT, t1.SAMPLING, t1.OPERATOR, t1.REMARK, t2.NAME AS CHECK_RESULT_NAME, t3.NAME AS BUSINESS_NAME, t4.NAME AS CALLED_TEAM_NAME
    FROM
        MARKET_CHECK t1
    LEFT JOIN SYSTEM_BASIC_CONFIG t2 ON t1.CHECK_RESULT = t2.CODE AND t2.MOUDLECODE = 'CHECK-RESULT'
    LEFT JOIN SYSTEM_BASIC_CONFIG t3 ON t1.BUSINESS = t3.CODE AND t3.MOUDLECODE = 'BIZ-NAME'
    LEFT JOIN SYSTEM_BASIC_CONFIG t4 ON t1.CALLED_TEAM = t4.CODE AND t4.MOUDLECODE = 'OUT-CALL-TEA'
    WHERE t1.PHONE_NO = #{phoneNo,jdbcType=VARCHAR}
  </select>

</mapper>